:root {
  /* Colors */
  /* Vecchi colori base, verranno sovrascritti/integrati dalla palette Apple */
  --color-background-old: rgba(252, 252, 249, 1);
  --color-surface-old: rgba(255, 255, 253, 1);
  --color-text-old: rgba(19, 52, 59, 1);
  --color-text-secondary-old: rgba(98, 108, 113, 1);
  --color-primary-old: rgba(33, 128, 141, 1);
  --color-border-old: rgba(94, 82, 64, 0.2);

  /* Apple Palette Integration */
  --apple-white: #FFFFFF;
  --apple-black: #000000; /* True black per dark mode background */
  --apple-off-black-text: #1D1D1F; /* Testo primario su sfondi chiari */

  --apple-blue-accent: #007AFF;
  --apple-orange-accent: #FF9500;
  --apple-red-error: #FF3B30;
  --apple-red-error-dark: #FF453A;

  --apple-gray-light-bg: #F2F2F7;    /* systemGray6 light */
  --apple-gray-medium-text-light: #8E8E93; /* systemGray light */
  --apple-gray-separator-light: #C6C6C8;   /* separator light */

  --apple-gray-dark-surface: #1C1C1E; /* systemGray6 dark */
  --apple-gray-medium-text-dark: rgba(235, 235, 245, 0.6); /* systemGray (Dark) */
  --apple-gray-separator-dark: #38383A; /* separator dark */

  /* Colori UI di base (Light Mode Default) */
  --color-background: var(--apple-gray-light-bg);
  --color-surface: var(--apple-white); /* Per card e superfici elevate */
  --color-text: var(--apple-off-black-text);
  --color-text-secondary: var(--apple-gray-medium-text-light);
  --color-primary: var(--apple-orange-accent); /* Accento principale */
  --color-primary-hover: #FFAC40;
  --color-primary-active: #F08C00;
  --color-error: var(--apple-red-error);
  --color-error-rgb: 255, 59, 48;
  --color-border: var(--apple-gray-separator-light);
  --color-btn-primary-text: var(--apple-white);
  --color-card-border: rgba(0,0,0,0.08); /* Bordo card sottile */
  --color-focus-ring: rgba(255, 149, 0, 0.4);
  --color-icon: var(--apple-gray-medium-text-light);

  /* Typography */
  --font-family-apple: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
  --font-family-base: var(--font-family-apple); /* Usa font Apple come base */
  --font-family-text: "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif; /* Per testo più lungo */
  --font-family-mono: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, monospace;

  --font-size-xs: 12px;  /* Caption 2 */
  --font-size-sm: 13px;  /* Footnote */
  --font-size-base: 17px; /* Body */
  --font-size-md: 17px;
  --font-size-lg: 20px;  /* Title 3 */
  --font-size-xl: 22px;  /* Title 2 */
  --font-size-2xl: 28px; /* Title 1 */
  --font-size-3xl: 34px; /* Large Title */

  --font-weight-regular: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;

  --line-height-tight: 1.25; /* Adattato per font SF */
  --line-height-normal: 1.45;
  --letter-spacing-tight: -0.022em;

  /* Spacing (basato su multipli di 4 e 8) */
  --spacing-xxs: 2px;
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;

  /* Border Radius (stile Apple) */
  --radius-button: 10px;
  --radius-card: 12px;
  --radius-small: 8px;
  --radius-full: 9999px;

  /* Shadows (sottili, stile Apple) */
  --shadow-card: 0 1px 3px rgba(0, 0, 0, 0.04); /* Ombra più leggera */
  --shadow-elevated: 0 4px 12px rgba(0, 0, 0, 0.08);

  --ease-standard: cubic-bezier(0.4, 0, 0.2, 1);

  /* RGB versions for backdrop blur */
  --color-surface-rgb-light: 242, 242, 247; /* systemGray6 light */
  --color-surface-rgb-dark: 28, 28, 30; /* systemGray6 dark */
  --color-surface-rgb: var(--color-surface-rgb-light); /* Default */
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-background: var(--apple-black);
    --color-surface: var(--apple-gray-dark-surface);
    --color-text: var(--apple-white);
    --color-text-secondary: var(--apple-gray-medium-text-dark);
    --color-primary: var(--apple-orange-accent);
    --color-primary-hover: #FFAC40;
    --color-primary-active: #F08C00;
    --color-border: var(--apple-gray-separator-dark);
    --color-card-border: rgba(255,255,255,0.12); /* Bordo card più visibile in dark */
    --color-error: var(--apple-red-error-dark);
    --color-error-rgb: 255, 69, 58;
    --color-btn-primary-text: var(--apple-black);
    --color-focus-ring: rgba(255, 149, 0, 0.5);
    --color-icon: var(--apple-gray-medium-text-dark);
    --color-surface-rgb: var(--color-surface-rgb-dark);
  }
}

/* Base styles */
html {
  font-family: var(--font-family-base);
  font-size: var(--font-size-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  box-sizing: border-box;
  letter-spacing: var(--letter-spacing-tight);
}
body { margin: 0; padding: 0; overflow-x: hidden; font-family: var(--font-family-text); } /* Default a SF Pro Text */
*, *::before, *::after { box-sizing: inherit; }

h1, h2, h3, h4, h5, h6 { margin: 0; font-family: var(--font-family-apple); /* SF Pro Display per titoli */ font-weight: var(--font-weight-semibold); line-height: var(--line-height-tight); color: var(--color-text); }
h1 { font-size: var(--font-size-3xl); letter-spacing: -0.03em;}
h2 { font-size: var(--font-size-2xl); letter-spacing: -0.028em;}
h3 { font-size: var(--font-size-xl); letter-spacing: -0.025em;}
h4 { font-size: var(--font-size-lg); letter-spacing: -0.022em;}
p { margin: 0 0 var(--spacing-md) 0; }

/* Buttons (Stile Apple) */
.btn {
  display: inline-flex; align-items: center; justify-content: center;
  padding: 10px var(--spacing-md); /* Padding verticale per altezza 44px con font 17px */
  border-radius: var(--radius-button);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium); /* Medium per bottoni standard iOS */
  cursor: pointer; border: none; text-decoration: none;
  min-height: 44px;
  transition: background-color 0.15s ease-out, transform 0.1s ease-out, border-color 0.15s ease-out;
  letter-spacing: -0.01em; /* Leggermente meno tracking per bottoni */
}
.btn:active { transform: scale(0.98); } /* Feedback più sottile */
.btn:focus-visible { outline: none; box-shadow: 0 0 0 4px var(--color-focus-ring); }


.btn--primary { background: var(--color-primary); color: var(--color-btn-primary-text); }
.btn--primary:hover { filter: brightness(1.05); } /* Leggero hover */
.btn--primary:active { filter: brightness(0.95); }

.btn--secondary {
  background: rgba(120,120,128,0.12); /* systemGray5 light */
  color: var(--color-text);
}
.btn--secondary:hover { background: rgba(120,120,128,0.20); }
.btn--secondary:active { background: rgba(120,120,128,0.28); }
@media (prefers-color-scheme: dark) {
  .btn--secondary { background: rgba(120,120,128,0.24); color: var(--color-text); } /* systemGray5 dark */
  .btn--secondary:hover { background: rgba(120,120,128,0.32); }
  .btn--secondary:active { background: rgba(120,120,128,0.40); }
}


.btn--outline {
  background: transparent;
  border: 1.5px solid var(--color-primary);
  color: var(--color-primary);
}
.btn--outline:hover { background: rgba(var(--color-accent-rgb, 255,149,0), 0.08); }
.btn--outline:active { background: rgba(var(--color-accent-rgb, 255,149,0), 0.12); }

.btn--danger { background-color: var(--color-error); color: var(--apple-white); }
.btn--danger:hover { filter: brightness(1.05); }
.btn--danger:active { filter: brightness(0.95); }

.btn--danger-outline {
    background: transparent;
    border: 1.5px solid var(--color-error);
    color: var(--color-error);
}
.btn--danger-outline:hover { background-color: rgba(var(--color-error-rgb), 0.08); }
.btn--danger-outline:active { background-color: rgba(var(--color-error-rgb), 0.12); }


.btn--sm { padding: 6px 12px; font-size: var(--font-size-sm); min-height: 38px; border-radius: var(--radius-small); }
.btn--large { padding: 14px var(--spacing-md); font-size: 18px; min-height: 50px;} /* Leggermente più alto */
.btn--full-width { width: 100%; }

.btn:disabled, .btn[disabled] {
    background-color: rgba(120,120,128,0.08); /* Più chiaro per disabled */
    color: rgba(60,60,67,0.3);
    cursor: not-allowed;
    opacity: 1;
    filter: none;
    transform: none;
    border-color: transparent !important; /* Sovrascrive per outline */
}
@media (prefers-color-scheme: dark) {
    .btn:disabled, .btn[disabled] {
        background-color: rgba(120,120,128,0.12);
        color: rgba(235,235,245,0.3);
    }
}
.btn--icon-only { /* Stile base per bottoni solo icona */
    padding: var(--spacing-sm);
    min-width: auto;
    width: 40px;
    height: 40px;
    border-radius: var(--radius-button);
}
.btn--icon-only svg {
    margin-right: 0;
}


/* Form elements (Stile Apple) */
.form-control {
  display: block; width: 100%;
  padding: 11px var(--spacing-sm); /* Padding tipico iOS textfield */
  font-size: var(--font-size-base);
  font-family: var(--font-family-text);
  color: var(--color-text);
  background-color: var(--color-surface);
  border: 0.5px solid var(--color-border); /* Bordo più sottile per input */
  border-radius: var(--radius-button);
  min-height: 44px;
  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}
textarea.form-control {
    padding-top: var(--spacing-sm);
    padding-bottom: var(--spacing-sm);
}
select.form-control {
  -webkit-appearance: none; -moz-appearance: none; appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%238A8A8E' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E"); /* Chevron Grigio Apple, più bold */
  background-repeat: no-repeat;
  background-position: right var(--spacing-md) center;
  padding-right: calc(var(--spacing-md) + 24px); /* Spazio per la freccia custom */
}
@media (prefers-color-scheme: dark) {
  select.form-control {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23636366' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  }
}
.form-control:focus {
  border-color: var(--color-primary);
  outline: none;
  box-shadow: 0 0 0 3px var(--color-focus-ring); /* Usa il focus ring arancione */
}
.form-label { display: block; margin-bottom: var(--spacing-xs); font-weight: var(--font-weight-regular); font-size: 15px; /* Footnote/Subhead iOS */ color: var(--color-text); }
.form-group { margin-bottom: var(--spacing-md); }


/* App Structure & General Styles */
.app-container { max-width: 430px; margin: 0 auto; display: flex; flex-direction: column; min-height: 100vh; background-color: var(--color-background); }
.app-header {
  background: rgba(var(--color-surface-rgb), 0.85); /* Materiale più denso */
  border-bottom: 0.5px solid var(--color-border);
  padding: 10px var(--spacing-md);
  position: sticky; top: 0; z-index: 100;
  backdrop-filter: blur(24px) saturate(180%);
  -webkit-backdrop-filter: blur(24px) saturate(180%);
}
:root { /* Definizioni RGB per header/tab bar */
  --color-surface-rgb-light: 242, 242, 247; /* systemGray6 light */
  --color-surface-rgb-dark: 28, 28, 30; /* systemGray6 dark */
  --color-surface-rgb: var(--color-surface-rgb-light); /* Default */
}
@media (prefers-color-scheme: dark) {
  :root { --color-surface-rgb: var(--color-surface-rgb-dark); }
}
.header-content { display: flex; justify-content: space-between; align-items: center; min-height: 30px; /* Altezza minima per header */ }
.app-title { font-size: var(--font-size-base); font-weight: var(--font-weight-semibold); }
.header-date { font-size: var(--font-size-base); color: var(--color-text-secondary); font-weight: var(--font-weight-regular); }

.main-content { flex: 1; padding: var(--spacing-sm) var(--spacing-md) calc(80px + env(safe-area-inset-bottom)); /* Aumentato padding inferiore per tab bar */ overflow-y: auto; }
.section { display: none; opacity: 0; transform: translateY(10px); transition: opacity 0.25s ease-out, transform 0.25s ease-out; }
.section.active { display: block; opacity: 1; transform: translateY(0); }

/* Card (Stile Apple List/Inset Grouped) */
.card, .welcome-card, .next-workout-card, .quote-card, .progress-card, .guide-card {
  background-color: var(--color-surface);
  border-radius: var(--radius-card);
  margin-bottom: var(--spacing-lg);
  box-shadow: none;
}
.card-content-item, .welcome-card > *, .next-workout-card > *, .quote-card > *, .progress-card > *, .guide-card > * {
    padding: 12px var(--spacing-md);
    border-bottom: 0.5px solid var(--color-border);
}
.card-content-item:last-child,
.welcome-card > *:last-child,
.next-workout-card > *:last-child,
.quote-card > *:last-child,
.progress-card > *:last-child,
.guide-card > *:last-child {
    border-bottom: none;
}
.welcome-card, .next-workout-card, .quote-card {
    padding: 0;
}
.welcome-card > :first-child, .next-workout-card > :first-child, .quote-card > :first-child {
    padding-top: var(--spacing-md);
}
.welcome-card > :last-child, .next-workout-card > :last-child, .quote-card > :last-child {
    padding-bottom: var(--spacing-md);
}

/* Specific Card Content Styles */
.welcome-title { font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); }
.welcome-subtitle { font-size: var(--font-size-lg); color: var(--color-text-secondary); }
.next-workout-card .card-header h3 { font-size: var(--font-size-lg); font-weight: var(--font-weight-semibold); }
.workout-day { background: var(--color-primary); color: var(--color-btn-primary-text); padding: 4px 8px; border-radius: var(--radius-small); font-size: 12px; font-weight: var(--font-weight-semibold); }
.workout-preview h4 { font-size: var(--font-size-base); font-weight: var(--font-weight-semibold); }
.workout-preview p { font-size: var(--font-size-sm); color: var(--color-text-secondary); }
.start-workout-btn { margin: var(--spacing-sm) var(--spacing-md) 0; width: calc(100% - (2 * var(--spacing-md))); }

.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 0.5px; background-color: var(--color-border); border: 0.5px solid var(--color-border); border-radius: var(--radius-card); overflow: hidden; margin-bottom: var(--spacing-lg);}
.stat-card { background: var(--color-surface); padding: var(--spacing-sm); text-align: center; border-radius: 0; box-shadow: none; border: none;}
.stat-number { font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); color: var(--color-primary); }
.stat-label { font-size: 11px; color: var(--color-text-secondary); font-weight: var(--font-weight-medium); }
.daily-quote { font-size: var(--font-size-base); font-style: italic; color: var(--color-text-secondary); text-align: center; padding: var(--spacing-md); }


/* Workout Section - New Styles */
.workout-controls-header {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-lg);
  padding-top: var(--spacing-sm);
}

.workout-info {
    text-align: left;
    margin-bottom: 0;
    padding: 0 var(--spacing-xs);
}
.workout-info h2 {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-text);
  margin-bottom: 2px;
}
.workout-info p {
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
  margin: 0;
}

.day-selector-area {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  width: 100%;
}

#daySelector.form-control {
  flex-grow: 1;
  background-color: var(--apple-white);
  border: 0.5px solid var(--apple-gray-separator);
  border-radius: var(--radius-button);
  padding: 11px var(--spacing-sm);
  font-size: var(--font-size-base);
  color: var(--color-text);
  height: 44px;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%238A8A8E' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right var(--spacing-md) center;
  padding-right: calc(var(--spacing-md) + 24px);
}
@media (prefers-color-scheme: dark) {
  #daySelector.form-control {
    background-color: var(--apple-gray-dark-surface);
    border-color: var(--apple-gray-separator-dark);
    color: var(--color-text);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%238E8E93' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  }
}

#daySelector.form-control:disabled {
  background-color: rgba(120,120,128,0.08);
  color: var(--color-text-secondary);
  opacity: 0.7;
}
@media (prefers-color-scheme: dark) {
    #daySelector.form-control:disabled {
        background-color: rgba(120,120,128,0.12);
    }
}


.day-management-buttons {
  display: flex;
  gap: var(--spacing-xs);
}

.day-management-buttons .btn.btn--icon-only {
  padding: var(--spacing-sm);
  min-width: auto;
  width: 40px;
  height: 40px;
  border-radius: var(--radius-button);
  background-color: rgba(120,120,128,0.12);
  color: var(--color-text);
}
.day-management-buttons .btn.btn--icon-only:hover {
    background-color: rgba(120,120,128,0.20);
}
@media (prefers-color-scheme: dark) {
    .day-management-buttons .btn.btn--icon-only {
        background-color: rgba(120,120,128,0.24);
         color: var(--color-text);
    }
     .day-management-buttons .btn.btn--icon-only:hover {
        background-color: rgba(120,120,128,0.32);
    }
}

.day-management-buttons .btn.btn--icon-only svg {
  margin-right: 0;
  width: 18px;
  height: 18px;
  stroke: currentColor;
}
.day-management-buttons .btn--danger-icon svg {
    stroke: var(--color-error) !important;
}


/* Pulsanti Azione Sessione */
#startWorkoutSessionBtn, #endWorkoutSessionBtn {
    padding: 12px var(--spacing-md);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-semibold);
    border-radius: var(--radius-button);
}
#startWorkoutSessionBtn:disabled {
    background-color: var(--color-primary);
    opacity: 0.4;
    color: var(--color-btn-primary-text);
    cursor: not-allowed;
}
#startWorkoutSessionBtn:disabled:hover {
    filter: none;
}


.add-exercise-placeholder {
    margin-top: var(--spacing-lg);
}
.add-exercise-placeholder .btn svg {
    margin-right: var(--spacing-sm);
    vertical-align: middle;
}

/* Nuova Card Esercizio Stile Apple */
.exercise-card-apple {
  background-color: var(--color-surface);
  border-radius: var(--radius-card);
  margin-bottom: var(--spacing-md);
  padding: 12px var(--spacing-md);
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.exercise-card-apple + .exercise-card-apple {
    border-top: 0.5px solid var(--color-border);
}

.exercise-card-apple .exercise-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--spacing-sm);
}

.exercise-card-apple .exercise-name {
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  flex-grow: 1;
  line-height: 1.3;
}

.exercise-card-apple .exercise-item-actions {
    display: flex;
}
.exercise-card-apple .exercise-item-actions .btn-icon {
  width: 32px;
  height: 32px;
  color: var(--apple-blue-accent); /* Blu per azioni standard */
  background-color: transparent;
}
.exercise-card-apple .exercise-item-actions .btn-icon svg {
  width: 20px; /* Icone più grandi per azioni esercizio */
  height: 20px;
}
.exercise-card-apple .exercise-item-actions .btn-icon:hover {
  background-color: rgba(0, 122, 255, 0.1);
}
.exercise-card-apple .exercise-item-actions .btn-delete-exercise {
    color: var(--apple-red-error);
}
.exercise-card-apple .exercise-item-actions .btn-delete-exercise:hover {
    background-color: rgba(var(--color-error-rgb), 0.1);
}


.exercise-card-apple .exercise-summary-details {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-sm) var(--spacing-md);
  padding: var(--spacing-xs) 0;
  color: var(--color-text-secondary);
  font-size: 15px;
  font-weight: var(--font-weight-regular);
}

.exercise-card-apple .summary-detail {
  display: inline-flex;
  align-items: center;
}
.exercise-card-apple .summary-detail .detail-icon {
  width: 15px;
  height: 15px;
  margin-right: 5px;
  stroke-width: 2px; /* Icone più definite */
  color: var(--color-text-secondary);
}
.exercise-card-apple .summary-detail strong {
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
    margin-right: 3px;
}


.exercise-card-apple .exercise-notes-container {
  margin-top: var(--spacing-xs);
  padding-top: var(--spacing-sm);
  border-top: 0.5px solid var(--color-border);
}
.exercise-card-apple .exercise-notes-preview {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-style: normal;
  line-height: 1.4;
}
.exercise-card-apple .exercise-notes-container:empty {
    display: none;
}


/* Area Tracciamento Set */
.exercise-set-trackers-container {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm); /* Aumentato gap tra i set tracker per chiarezza */
    margin-top: var(--spacing-md);
    padding-top: var(--spacing-sm);
    border-top: 0.5px solid var(--color-border);
}

.set-tracker-row {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-xs) 0;
}

.set-number-badge {
    font-size: 15px; /* Leggermente più grande */
    font-weight: var(--font-weight-medium); /* Medium per meno enfasi del bold */
    color: var(--color-text-secondary);
    min-width: 45px;
    text-align: left;
    flex-shrink: 0;
}

.set-input-group {
    display: flex;
    align-items: center;
    background-color: var(--apple-gray-light-bg);
    border-radius: 8px;
    padding: 0 10px;
    flex-grow: 1;
    height: 40px; /* Leggermente più bassi dei bottoni principali */
}
@media (prefers-color-scheme: dark) {
    .set-input-group {
        background-color: rgba(120,120,128,0.24);
    }
}

.set-input-group input[type="number"].set-input-weight,
.set-input-group input[type="number"].set-input-reps {
    flex-grow: 1;
    padding: 8px 4px;
    border: none;
    background: transparent;
    font-size: var(--font-size-base);
    font-family: var(--font-family-text); /* Assicura SF Pro Text */
    font-weight: var(--font-weight-regular);
    min-width: 30px;
    text-align: center;
    color: var(--color-text);
    -moz-appearance: textfield;
}
.set-input-group input[type="number"]::-webkit-outer-spin-button,
.set-input-group input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.set-input-group span {
    font-size: var(--font-size-sm);
    font-family: var(--font-family-text);
    color: var(--color-text-secondary);
    padding-left: 4px;
}
.set-input-group:focus-within {
    outline: 2px solid var(--color-primary);
    outline-offset: 0px; /* Outline attaccato */
    box-shadow: none;
}


.set-complete-button {
    width: 36px; /* Touch target Apple-like */
    height: 36px;
    border-radius: 50%;
    border: 2px solid var(--apple-gray-separator-light); /* Bordo più visibile */
    background-color: transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    flex-shrink: 0;
    transition: background-color 0.15s ease, border-color 0.15s ease;
}
.set-complete-button svg {
    width: 18px; /* Icona spunta/cerchio */
    height: 18px;
    stroke-width: 2.5;
    color: var(--apple-gray-separator-light);
}
@media (prefers-color-scheme: dark) {
    .set-complete-button {
        border-color: var(--apple-gray-separator-dark);
    }
    .set-complete-button svg {
        color: var(--apple-gray-separator-dark);
    }
}


.set-tracker-row.completed .set-complete-button {
    background-color: var(--color-primary);
    border-color: var(--color-primary);
}
.set-tracker-row.completed .set-complete-button svg {
    color: var(--apple-white);
}

.set-complete-button .check-icon { display: none; }
.set-complete-button .circle-icon { display: block; }
.set-tracker-row.completed .set-complete-button .check-icon { display: block; }
.set-tracker-row.completed .set-complete-button .circle-icon { display: none; }

.set-tracker-row input:disabled,
.set-tracker-row .set-complete-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
.set-tracker-row .set-complete-button:disabled {
    border-color: var(--apple-gray-light-bg);
    background-color: transparent; /* O un grigio molto chiaro */
}
.set-tracker-row .set-complete-button:disabled svg {
    color: var(--apple-gray-separator-light);
}
@media (prefers-color-scheme: dark) {
    .set-tracker-row .set-complete-button:disabled {
        border-color: var(--apple-gray-dark-surface);
    }
    .set-tracker-row .set-complete-button:disabled svg {
        color: var(--apple-gray-separator-dark);
    }
}

.exercise-session-controls {
    margin-top: var(--spacing-sm);
    padding-top: var(--spacing-sm);
    border-top: 0.5px solid var(--color-border);
}
.exercise-session-controls .btn svg {
    margin-right: 6px;
    width: 16px;
    height: 16px;
}


/* Timer Section */
.timer-container {
  padding: var(--spacing-lg) 0;
  text-align: center;
}

.timer-display {
  margin-bottom: var(--spacing-xl);
}

.timer-circle {
  position: relative;
  display: inline-block;
}

.timer-progress {
  transform: rotate(-90deg);
}

.timer-track {
  fill: none;
  stroke: var(--color-border);
  stroke-width: 8;
}

.timer-fill {
  fill: none;
  stroke: var(--color-primary);
  stroke-width: 8;
  stroke-linecap: round;
  stroke-dasharray: 565.48;
  stroke-dashoffset: 565.48;
  transition: stroke-dashoffset 1s linear;
}

.timer-time {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 48px; /* Ridotto per coerenza con altri testi grandi */
  font-weight: var(--font-weight-regular); /* Regular per timer */
  color: var(--color-text);
  font-family: var(--font-family-mono); /* Mantenuto mono per i numeri */
  letter-spacing: -0.025em;
}

.timer-controls {
  display: flex;
  justify-content: center;
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-xl);
}

.timer-controls .btn { /* Bottoni Play/Reset */
  min-width: 80px;
  background-color: rgba(120,120,128,0.12); /* systemGray5 light */
  color: var(--color-text);
}
.timer-controls .btn:hover {
    background-color: rgba(120,120,128,0.20);
}
@media (prefers-color-scheme: dark) {
    .timer-controls .btn {
        background-color: rgba(120,120,128,0.24);
    }
    .timer-controls .btn:hover {
        background-color: rgba(120,120,128,0.32);
    }
}


.timer-icon {
  font-size: 20px;
}

.timer-presets,
.custom-timer {
  background: var(--color-surface);
  border-radius: var(--radius-card);
  padding: var(--spacing-lg);
  margin-bottom: var(--spacing-md);
  box-shadow: none; /* Rimosso shadow per stile grouped */
}
.timer-presets:not(:first-child), .custom-timer:not(:first-child) {
    margin-top: var(--spacing-lg); /* Spazio tra gruppi di card */
}


.timer-presets h3,
.custom-timer h3 {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  margin: 0 0 var(--spacing-md) 0;
  text-align: left; /* Titoli allineati a sinistra */
  padding: 0 var(--spacing-xs); /* Allinea con padding card */
}

.preset-buttons {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)); /* Più flessibile */
  gap: var(--spacing-sm);
  padding: 0 var(--spacing-xs);
}

.preset-btn {
  background: var(--color-background);
  border: 0.5px solid var(--color-border);
  border-radius: var(--radius-button);
  padding: var(--spacing-sm); /* Padding ridotto per bottoni preset */
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  min-height: 40px;
}

.preset-btn:hover, .preset-btn:active {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  transform: scale(0.98);
  border-color: var(--color-primary);
}

.time-input {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs); /* Gap ridotto */
  margin-bottom: var(--spacing-md);
}

.time-field { /* Input per minuti/secondi custom timer */
  width: 70px; /* Più larghi per tocco facile */
  text-align: center;
  font-size: var(--font-size-lg); /* Più grande per leggibilità */
  font-weight: var(--font-weight-regular);
  padding: var(--spacing-sm);
  border: 0.5px solid var(--color-border);
  border-radius: var(--radius-small);
  background: var(--color-background);
  color: var(--color-text);
  -moz-appearance: textfield;
}
.time-field::-webkit-outer-spin-button,
.time-field::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}


.time-input span { /* Separatore ":" */
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-secondary);
  padding: 0 var(--spacing-xs);
}

/* Progress Section */
.progress-header h2 {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  margin-bottom: var(--spacing-sm); /* Spazio sotto il titolo */
  padding: 0 var(--spacing-xs);
}

.week-calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: var(--spacing-xs);
  background-color: var(--color-surface);
  padding: var(--spacing-sm);
  border-radius: var(--radius-small); /* Arrotonda il calendario */
}

.day-item { /* Stile Apple per calendario */
  aspect-ratio: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-radius: 6px; /* Cerchi più piccoli */
  font-size: 11px; /* Testo giorno settimana */
  font-weight: var(--font-weight-medium);
  color: var(--color-text-secondary);
  background: transparent; /* Sfondo trasparente di base */
}
.day-item div:last-child { /* Numero del giorno */
    font-size: 15px;
    font-weight: var(--font-weight-regular);
    color: var(--color-text);
    margin-top: 2px;
}

.day-item.completed {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}
.day-item.completed div:last-child {
    color: var(--color-btn-primary-text);
    font-weight: var(--font-weight-semibold);
}

.day-item.today div:last-child { /* Evidenzia numero giorno corrente */
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: var(--font-weight-semibold);
}
.day-item.today.completed div:last-child { /* Se oggi è anche completato */
    background-color: var(--color-surface);
    color: var(--color-primary);
    border: 1.5px solid var(--color-primary);
}


.stats-list { /* Usato in Progressi e per RecentWeights */
  display: flex;
  flex-direction: column;
  gap: 0; /* Separatori gestiti da border-bottom */
}

.stat-item, .log-exercise-item { /* Stile base per righe di lista */
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0; /* Padding verticale per righe */
  border-bottom: 0.5px solid var(--color-border);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-regular);
}
.progress-card .card-content-item .stat-item:last-child { /* Rimuovi bordo dall'ultimo item se dentro una card */
    border-bottom: none;
}
.log-exercise-item {
    flex-direction: column; /* Nome esercizio sopra, set sotto */
    align-items: flex-start;
}
.log-exercise-item strong {
    font-weight: var(--font-weight-medium);
    margin-bottom: var(--spacing-xs);
}

.log-set-item {
    padding-left: var(--spacing-md);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    padding-top: 4px;
    padding-bottom: 4px;
    border-bottom: none; /* No border per i sub-item */
}
.progress-card .card-content-item ul.stats-list { /* Se ul.stats-list è dentro un .card-content-item */
    padding: 0;
}
.progress-card .card-content-item ul.stats-list li.stat-item:first-child {
    padding-top: 0;
}


.no-data {
  text-align: center;
  color: var(--color-text-secondary);
  font-style: normal; /* Non corsivo per stile Apple */
  font-size: var(--font-size-base);
  padding: var(--spacing-lg) 0; /* Più padding per stati vuoti */
}

/* Guide Section (Stile Apple per liste e testo) */
.guide-header h2 {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  margin-bottom: var(--spacing-sm);
  padding: 0 var(--spacing-xs);
}

.rpe-scale { display: flex; flex-direction: column; gap: 0; /* Gestito da separatori item */ }
.rpe-item { display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-sm) 0; border-bottom: 0.5px solid var(--color-border); }
.rpe-item:last-child { border-bottom: none; }
.rpe-number {
  width: 36px; height: 36px; /* Leggermente più piccoli */
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-weight: var(--font-weight-semibold); font-size: 15px;
  color: white; flex-shrink: 0;
}
.rpe-10 { background: #FF3B30; }
.rpe-9 { background: #FF9500; }
.rpe-8 { background: #FFCC02; color: var(--apple-black); } /* Testo nero per leggibilità su giallo */
.rpe-7 { background: #34C759; }
.rpe-6 { background: var(--apple-blue-accent); } /* Blu Apple per RPE 6 */

.rpe-description h4 { font-size: var(--font-size-base); font-weight: var(--font-weight-medium); margin-bottom: 2px; }
.rpe-description p { font-size: var(--font-size-sm); color: var(--color-text-secondary); margin: 0; line-height: 1.3; }

.tips-list { display: flex; flex-direction: column; gap: 0; }
.tip-item { display: flex; gap: var(--spacing-md); padding: var(--spacing-md) 0; border-bottom: 0.5px solid var(--color-border); }
.tip-item:last-child { border-bottom: none; }
.tip-number {
  width: 28px; height: 28px;
  border-radius: 50%;
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  display: flex; align-items: center; justify-content: center;
  font-weight: var(--font-weight-semibold); font-size: 15px;
  flex-shrink: 0;
}
.tip-content h4 { font-size: var(--font-size-base); font-weight: var(--font-weight-medium); margin-bottom: var(--spacing-xs); }
.tip-content p { font-size: var(--font-size-sm); color: var(--color-text-secondary); margin: 0; line-height: 1.4; }

/* Tab Bar (Stile Apple) */
.tab-bar {
  position: fixed; bottom: 0; left: 0; right: 0; /* Full width */
  max-width: 430px; margin: 0 auto; /* Centra se c'è max-width */
  background: rgba(var(--color-surface-rgb),0.85); /* Materiale più denso */
  border-top: 0.5px solid var(--color-border);
  display: flex;
  padding: var(--spacing-xs) 0 env(safe-area-inset-bottom); /* Padding ridotto e safe area */
  backdrop-filter: blur(24px) saturate(180%);
  -webkit-backdrop-filter: blur(24px) saturate(180%);
  z-index: 1000;
}

.tab-item {
  flex: 1; display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 4px 0; /* Padding verticale per item */
  background: none; border: none; cursor: pointer;
  transition: color 0.15s ease-out;
  color: var(--apple-gray-medium-text-light); /* Colore icone inattive */
}
.tab-item.active { color: var(--color-primary); /* Colore accento per attiva */ }
.tab-item:active { transform: scale(0.95); } /* Feedback tocco */
@media (prefers-color-scheme: dark) {
    .tab-item { color: var(--apple-gray-medium-text-dark); }
    .tab-item.active { color: var(--color-primary); }
}


.tab-icon svg {
  width: 26px; /* Dimensione icone tab iOS */
  height: 26px;
  stroke-width: 1.5; /* SF Symbol-like */
}
.tab-label {
  font-size: 10px; /* Dimensione etichetta tab iOS */
  font-weight: var(--font-weight-medium);
  margin-top: 1px; /* Spazio tra icona e etichetta */
  letter-spacing: -0.005em;
}

/* Modal Styles */
.modal {
  display: none;
  position: fixed;
  z-index: 2000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.4);
  align-items: center;
  justify-content: center;
  display: flex;
}

.modal-content {
  background-color: var(--color-surface);
  margin: auto;
  padding: var(--spacing-lg);
  border: none;
  border-radius: var(--radius-card);
  width: 90%;
  max-width: 400px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.12);
  position: relative;
  animation: fadeInModal 0.25s var(--ease-standard);
}

@keyframes fadeInModal {
  from { opacity: 0; transform: translateY(-20px) scale(0.98); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.close-btn {
  color: var(--apple-gray-medium-text-light);
  float: none;
  font-size: 22px;
  font-weight: var(--font-weight-regular);
  line-height: 1;
  position: absolute;
  top: 12px;
  right: 12px;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(120,120,128,0.12);
  border-radius: 50%;
}
@media (prefers-color-scheme: dark) {
    .close-btn {
        background-color: rgba(120,120,128,0.24);
        color: var(--apple-gray-medium-text-dark);
    }
}

.close-btn:hover,
.close-btn:focus {
  background-color: rgba(120,120,128,0.20);
  color: var(--color-text);
  text-decoration: none;
  cursor: pointer;
}
@media (prefers-color-scheme: dark) {
    .close-btn:hover, .close-btn:focus {
        background-color: rgba(120,120,128,0.32);
    }
}


.modal h3 {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--spacing-lg);
    color: var(--color-text);
    text-align: center;
}

.form-group label {
    display: block;
    font-size: 15px;
    font-weight: var(--font-weight-regular);
    margin-bottom: var(--spacing-xs);
    color: var(--color-text);
}

.form-actions {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    margin-top: var(--spacing-lg);
}
.form-actions .btn {
    flex-grow: 0;
    width: 100%;
}
.form-actions .btn--outline {
    border-color: var(--color-primary); /* Usa colore primario per outline in modale */
    color: var(--color-primary);
}
.form-actions .btn--outline:hover {
    background-color: rgba(var(--color-accent-rgb, 255,149,0), 0.08);
}


.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-md);
}

@media (max-width: 420px) {
    .form-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }
    .modal-content {
        padding: var(--spacing-md);
        width: calc(100% - (2 * var(--spacing-sm)));
        margin: var(--spacing-sm);
    }
}

/* PWA specific styles */
@media (display-mode: standalone) {
  .app-header {
    padding-top: calc(10px + env(safe-area-inset-top)); /* Adattato padding header */
  }
}
